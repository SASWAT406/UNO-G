<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 900px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .game-info {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .info-item {
            text-align: center;
        }

        .info-item label {
            display: block;
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .info-item span {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .center-area {
            text-align: center;
            margin: 30px 0;
        }

        .top-card {
            display: inline-block;
            width: 100px;
            height: 140px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin: 10px;
        }

        .red { background-color: #e74c3c; }
        .green { background-color: #27ae60; }
        .blue { background-color: #3498db; }
        .yellow { background-color: #f39c12; }

        .message {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            background: #e3f2fd;
            border-radius: 8px;
            color: #1976d2;
            font-weight: 500;
        }

        .message.error {
            background: #ffebee;
            color: #c62828;
        }

        .message.success {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .player-hand {
            margin: 20px 0;
        }

        .player-hand h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .card {
            width: 80px;
            height: 110px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        button {
            padding: 12px 30px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .draw-btn {
            background: #3498db;
            color: white;
        }

        .draw-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .new-game-btn {
            background: #27ae60;
            color: white;
        }

        .new-game-btn:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .game-over {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin: 20px 0;
        }

        .game-over h2 {
            font-size: 36px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>ðŸŽ´ Card Game</h1>
        
        <div class="game-info">
            <div class="info-item">
                <label>Your Cards</label>
                <span id="p1-count">7</span>
            </div>
            <div class="info-item">
                <label>Opponent Cards</label>
                <span id="p2-count">7</span>
            </div>
            <div class="info-item">
                <label>Draw Pile</label>
                <span id="draw-count">26</span>
            </div>
        </div>

        <div class="center-area">
            <h3>Top Card</h3>
            <div class="top-card" id="top-card">R0</div>
        </div>

        <div id="message" class="message">Game started! Your turn.</div>

        <div id="game-over-banner" class="game-over" style="display: none;">
            <h2 id="winner-text">You Win!</h2>
            <p>Congratulations!</p>
        </div>

        <div class="player-hand">
            <h3>Your Cards</h3>
            <div class="cards-container" id="player-cards"></div>
        </div>

        <div class="controls">
            <button class="draw-btn" id="draw-btn" onclick="drawCard()">Draw Card</button>
            <button class="new-game-btn" onclick="newGame()">New Game</button>
        </div>
    </div>

    <script>
        let gameState = {};

        async function updateGameState() {
            try {
                const response = await fetch('/game_state');
                gameState = await response.json();
                renderGame();
            } catch (error) {
                console.error('Error updating game state:', error);
            }
        }

        function renderGame() {
            // Update counts
            document.getElementById('p1-count').textContent = gameState.play1_count;
            document.getElementById('p2-count').textContent = gameState.play2_count;
            document.getElementById('draw-count').textContent = gameState.draw_pile_count;

            // Update top card
            const topCard = document.getElementById('top-card');
            topCard.textContent = gameState.top_card;
            topCard.className = 'top-card ' + gameState.top_color;

            // Update message
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = gameState.message;
            messageDiv.className = 'message';

            // Render player cards
            const cardsContainer = document.getElementById('player-cards');
            cardsContainer.innerHTML = '';
            
            gameState.play1.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card ' + getCardColor(card);
                cardDiv.textContent = card;
                cardDiv.onclick = () => playCard(card);
                cardsContainer.appendChild(cardDiv);
            });

            // Handle game over
            if (gameState.game_over) {
                document.getElementById('game-over-banner').style.display = 'block';
                document.getElementById('winner-text').textContent = gameState.winner + ' Wins!';
                document.getElementById('draw-btn').disabled = true;
                messageDiv.className = 'message success';
            } else {
                document.getElementById('game-over-banner').style.display = 'none';
                document.getElementById('draw-btn').disabled = false;
            }
        }

        function getCardColor(card) {
            const colors = {'R': 'red', 'G': 'green', 'B': 'blue', 'Y': 'yellow'};
            return colors[card[0]] || 'gray';
        }

        async function playCard(card) {
            if (gameState.game_over) return;

            try {
                const response = await fetch('/play_card', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({card: card})
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    const messageDiv = document.getElementById('message');
                    messageDiv.textContent = result.message;
                    messageDiv.className = 'message error';
                } else {
                    await updateGameState();
                }
            } catch (error) {
                console.error('Error playing card:', error);
            }
        }

        async function drawCard() {
            if (gameState.game_over) return;

            try {
                const response = await fetch('/draw_card', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const result = await response.json();
                await updateGameState();
            } catch (error) {
                console.error('Error drawing card:', error);
            }
        }

        async function newGame() {
            try {
                await fetch('/new_game', {method: 'POST'});
                await updateGameState();
            } catch (error) {
                console.error('Error starting new game:', error);
            }
        }

        // Initialize game on page load
        updateGameState();
    </script>
</body>
</html>
